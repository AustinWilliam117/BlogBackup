---
title: 实验15 安装新的int9中断例程
date: 2021-08-04 19:45:27
tags: ["汇编"]
categories: ["计算机基础"]
---

编程：在屏幕中间依次显示”a~z“,并可以让人看清，在显示过程中，按下esc键后，改变显示颜色,依次显示”a~z“

assume cs:code
code segment

start:  mov ax,0b800h
   mov es,ax
   mov ah,'a'
   
  s: mov es:[160*12+40*2],ah
   inc ah
   cmp ah,'z'
   jna s
   mov ax,4c00h
   int 21h
   
code ends
end start

每显示一个字母后，延时一段时间，让人看清，再显示下一个字母
我们可以让cpu执行一段时间的空循环，cpu执行的速度非常块，所以循环次数一定要到
用两个16位寄存器存放32位的循环次数

```asm
        mov dx,10h
        mov ax,0
  s:    sub ax,1
        sbb dx,0  ;带借位减法
        cmp ax,0
        jne s
        cmp dx,0
        jne s
```
   
上面的程序，循环1000000h次，我们可以将循环延时的程序写作一个子程序

```asm
assume cs:code
stack segment
 db 128 dup (0)
stack ends

code segment

start:      mov ax,stack
            mov ss,ax
            mov sp,128
            
            mov ax,0b800h
            mov es,ax
            mov ah,'a'
   s:       mov es:[160*12+40*2],ah
            call delay
            inc ah
            cmp ah,'z'
            jna s
            
            mov ax,4c00h
            int 21h
    
  delay:    push ax
            push dx
            mov dx,1000h  ;循环100000000h
            mov ax,0
    s1:     sub ax,1
            sbb dx,0
            cmp ax,0
            jne s1
            cmp dx,0
            jne s1
            pop dx
            pop ax
            ret
            
        code ends

        end start

键盘输入的处理过程:
1.键盘产生扫描码
2.扫描码送入60h端口
3.引发9号中断
4.cpuz执行int9中断例程处理键盘输入

键盘输入到达60h端口后，就会引发9好中断，cpu则转去执行int 9中断例程

1.从60h端口读出键盘输入
2.调用bios的int 9中断例程，处理其他硬件细节
3.判断是否为Esc的扫描码，如果是，改变显示的颜色后返回；如果不是则直接返回

